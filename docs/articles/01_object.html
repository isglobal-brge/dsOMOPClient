<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. Interface object • dsOMOPClient</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. Interface object">
<meta property="og:description" content="dsOMOPClient">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dsOMOPClient</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_object.html">1. Interface object</a>
    </li>
    <li>
      <a href="../articles/02_tables.html">2. Table retrieval</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. Interface object</h1>
            
      
      
      <div class="hidden name"><code>01_object.Rmd</code></div>

    </div>

    
    
<p><strong>Important Note:</strong> The <code>dsOMOPClient</code>
package serves as a client-side interface with DataSHIELD servers,
facilitating the retrieval of tables from OMOP CDM databases based on
resources and integrating such tables into the DataSHIELD workflow.
However, users will need to manually carry out the subsequent processes
of transforming the resulting tables into a single dataset afterwards
using the DataSHIELD base functions of <code>dsBaseClient</code>.</p>
<p>Auxiliary packages automate this integration, which is why we
recommend taking a look at packages like <code>dsOMOPHelper</code>
instead of directly using <code>dsOMOPClient</code>. We advise against
the direct use of <code>dsOMOPClient</code> for regular researchers
unless faced with an edge-case usage that requires the flexibility of
operating directly with the <code>dsOMOPClient</code> data interface at
a more primitive level, or for developers who are building their own
packages on top of <code>dsOMOPClient</code>.</p>
<p>For more information on <code>dsOMOPHelper</code>, please visit <a href="https://github.com/isglobal-brge/dsOMOPHelper" class="external-link">its GitHub
repository</a>.</p>
<div class="section level2">
<h2 id="creating-an-interface-object">1.1 Creating an interface object<a class="anchor" aria-label="anchor" href="#creating-an-interface-object"></a>
</h2>
<p>The <code>ds.omop</code> function creates an interface object that
allows users to interact with the OMOP CDM database based on a resource.
This object enables obtaining tables from the database by applying
desired filters and querying data catalogs for information present in
the database.</p>
<p>In this example, we will be using the <a href="https://physionet.org/content/mimic-iv-demo-omop/0.9/" class="external-link">MIMIC
IV</a> data available on the <a href="https://opal.isglobal.org/brge" class="external-link">Opal server of the BRGE at
ISGlobal</a>. We will establish a connection to our server using
<code>DSI</code> with the following demonstration user credentials:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSOpal/" class="external-link">DSOpal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsBaseClient</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">dsOMOPClient</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span></span>
<span>  server <span class="op">=</span> <span class="st">"brge"</span>,</span>
<span>  url <span class="op">=</span> <span class="st">"https://opal.isglobal.org/brge"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"omop_demo"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"P@ssw0rd"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">logindata</span> <span class="op">&lt;-</span> <span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span>logins <span class="op">=</span> <span class="va">logindata</span><span class="op">)</span></span></code></pre></div>
<p>Once we have successfully established a connection with the server,
we will create the object with <code>ds.omop</code>. The function
requires the following parameters:</p>
<ul>
<li>
<code>connections</code>: A list of established DataSHIELD
connections.</li>
<li>
<code>resource</code>: The name of the resource of the OMOP CDM
database in the DataSHIELD server.</li>
</ul>
<p>Our server contains the database connection resource under the name
<code>mimiciv</code> within the <code>omop_demo</code> project.
Therefore, we need to specify that, from the connection we have
established, we want to take the <code>omop_demo.mimiciv</code>
resource.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.omop.html">ds.omop</a></span><span class="op">(</span></span>
<span>  connections <span class="op">=</span> <span class="va">conns</span>,</span>
<span>  resource <span class="op">=</span> <span class="st">"omop_demo.mimiciv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="establishing-multiple-connections">1.1.1 Establishing multiple connections<a class="anchor" aria-label="anchor" href="#establishing-multiple-connections"></a>
</h3>
<p>If we wish to establish connections with multiple OMOP CDM databases
simultaneously in a <code>connections</code> pool, the
<code>resource</code> parameter accepts a named list as a parameter
where the name of the list object corresponds to the server name, and
the value corresponds to the resource name. For example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.omop.html">ds.omop</a></span><span class="op">(</span></span>
<span>  connections <span class="op">=</span> <span class="va">conns</span>,</span>
<span>  resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>brge <span class="op">=</span> <span class="st">"omop_demo.mimiciv"</span>,</span>
<span>                  another_server <span class="op">=</span> <span class="st">"project.resource"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="interface-object-functions">1.2 Interface object functions<a class="anchor" aria-label="anchor" href="#interface-object-functions"></a>
</h2>
<p>The <code>ds.omop</code> interface object provides several functions
to interact with the OMOP CDM database. These functions allow users to
query information from the database and extract tables, which will then
be transformed and integrated into the DataSHIELD workflow.</p>
<div class="section level3">
<h3 id="querying-information">1.2.1 Querying information<a class="anchor" aria-label="anchor" href="#querying-information"></a>
</h3>
<ul>
<li>
<code>tables()</code>: This function lists all the available tables
in the OMOP CDM database. It allows users to understand the structure of
the database and identify which tables might be relevant for their
analysis.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">tables</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">##  [1] "attribute_definition" "care_site"            "cdm_source"          </span></span>
<span><span class="co">##  [4] "cohort"               "cohort_attribute"     "cohort_definition"   </span></span>
<span><span class="co">##  [7] "concept_relationship" "condition_era"        "condition_occurrence"</span></span>
<span><span class="co">## [10] "cost"                 "death"                "device_exposure"     </span></span>
<span><span class="co">## [13] "dose_era"             "drug_era"             "drug_exposure"       </span></span>
<span><span class="co">## [16] "fact_relationship"    "location"             "measurement"         </span></span>
<span><span class="co">## [19] "metadata"             "note"                 "note_nlp"            </span></span>
<span><span class="co">## [22] "observation"          "observation_period"   "payer_plan_period"   </span></span>
<span><span class="co">## [25] "person"               "procedure_occurrence" "provider"            </span></span>
<span><span class="co">## [28] "specimen"             "visit_detail"         "visit_occurrence"    </span></span>
<span><span class="co">## [31] "vocabulary"           "concept"</span></span></code></pre>
<ul>
<li>
<code>columns(tableName)</code>: Given a table name, this function
returns the columns available in that table. This is useful for users to
identify the specific data fields they might want to analyze or use in
their queries.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">columns</span><span class="op">(</span><span class="st">"measurement"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">##  [1] "measurement_id"                "person_id"                    </span></span>
<span><span class="co">##  [3] "measurement_concept_id"        "measurement_date"             </span></span>
<span><span class="co">##  [5] "measurement_datetime"          "measurement_time"             </span></span>
<span><span class="co">##  [7] "measurement_type_concept_id"   "operator_concept_id"          </span></span>
<span><span class="co">##  [9] "value_as_number"               "value_as_concept_id"          </span></span>
<span><span class="co">## [11] "unit_concept_id"               "range_low"                    </span></span>
<span><span class="co">## [13] "range_high"                    "provider_id"                  </span></span>
<span><span class="co">## [15] "visit_occurrence_id"           "visit_detail_id"              </span></span>
<span><span class="co">## [17] "measurement_source_value"      "measurement_source_concept_id"</span></span>
<span><span class="co">## [19] "unit_source_value"             "value_source_value"</span></span></code></pre>
<ul>
<li>
<code>concepts(tableName)</code>: This function retrieves the
concepts present in a given table and returns them as a data frame with
two columns: <code>concept_id</code> and their associated
<code>concept_name</code>. Concepts in OMOP CDM are standardized terms
that represent clinical events, measurements, and other entities.
Understanding the concepts available in a table can help users to
formulate data filtering queries.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">concepts</span><span class="op">(</span><span class="st">"measurement"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">##    concept_id                                         concept_name</span></span>
<span><span class="co">## 1           0                                  No matching concept</span></span>
<span><span class="co">## 2     1175625                              Breath rate spontaneous</span></span>
<span><span class="co">## 3     3000067   Parathyrin.intact [Mass/volume] in Serum or Plasma</span></span>
<span><span class="co">## 4     3000068                        oxyCODONE [Presence] in Urine</span></span>
<span><span class="co">## 5     3000099    Nuclear Ab [Units/volume] in Serum by Immunoassay</span></span>
<span><span class="co">## 6     3000285                       Sodium [Moles/volume] in Blood</span></span>
<span><span class="co">## 7     3000330              Specific gravity of Urine by Test strip</span></span>
<span><span class="co">## 8     3000348 Leukocyte esterase [Presence] in Urine by Test strip</span></span>
<span><span class="co">## 9     3000456   Dacrocytes [Presence] in Blood by Light microscopy</span></span>
<span><span class="co">## 10    3000461                  Pressure support setting Ventilator</span></span>
<span><span class="co">##  [ reached 'max' / getOption("max.print") -- omitted 440 rows ]</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="retrieving-tables">1.2.2 Retrieving tables<a class="anchor" aria-label="anchor" href="#retrieving-tables"></a>
</h3>
<ul>
<li>
<code>get(tableName)</code>: This function enables users to extract
a specific table from the OMOP CDM database. The extracted table becomes
available within the DataSHIELD environment, where it can be manipulated
using other DataSHIELD functions and potentially combined with other
tables from the database. Users have the flexibility to apply filters
and specify columns to customize the extracted data according to their
research needs. Below are some examples of how to use the
<code>get</code> function:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"person"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"person"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">##  [1] "person_id"            "gender_concept_id"    "year_of_birth"       </span></span>
<span><span class="co">##  [4] "month_of_birth"       "day_of_birth"         "birth_datetime"      </span></span>
<span><span class="co">##  [7] "race_concept_id"      "ethnicity_concept_id" "location_id"         </span></span>
<span><span class="co">## [10] "provider_id"          "care_site_id"</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"measurement"</span>,</span>
<span>      symbol <span class="op">=</span> <span class="st">"meas"</span>,</span>
<span>      columnFilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value_as_number"</span>, <span class="st">"measurement_date"</span><span class="op">)</span>,</span>
<span>      conceptFilter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000099</span>, <span class="fl">3000068</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dsBaseClient/man/ds.summary.html" class="external-link">ds.summary</a></span><span class="op">(</span><span class="st">"meas"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $brge</span></span>
<span><span class="co">## $brge$class</span></span>
<span><span class="co">## [1] "omop.cdm.table" "data.frame"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of rows`</span></span>
<span><span class="co">## [1] 17</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`number of columns`</span></span>
<span><span class="co">## [1] 11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $brge$`variables held`</span></span>
<span><span class="co">## [1] "person_id"                                                       </span></span>
<span><span class="co">## [2] "nuclear_ab_units_volume_in_serum_by_immunoassay.measurement_date"</span></span>
<span><span class="co">## [3] "nuclear_ab_units_volume_in_serum_by_immunoassay.value_as_number" </span></span>
<span><span class="co">## [4] "oxycodone_presence_in_urine.measurement_date"                    </span></span>
<span><span class="co">## [5] "oxycodone_presence_in_urine.value_as_number"                     </span></span>
<span><span class="co">##  [ reached getOption("max.print") -- omitted 6 entries ]</span></span></code></pre>
<p>These functions form the core of the <code>ds.omop</code> interface
object’s capabilities, enabling users to effectively interact with OMOP
CDM databases within the DataSHIELD environment. It is expected that the
various resulting tables will be relationally joined using the
<code>ds.merge</code> function through their common identifiers, such as
<code>person_id</code>.</p>
<p>In the next articles, we will explore the internal workings of the
table processing operations, understanding how to manipulate and combine
tables into single datasets ready for analysis, along with a deeper dive
into the customization possibilities of the <code>get</code> function
and its potential applications.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Sarrat González, Xavier Escribà Montagut, Juan R González.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
